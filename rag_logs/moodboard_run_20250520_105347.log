2025-05-20 10:53:47,815 - INFO - __main__ - RAG Music Moodboard Script Started.
2025-05-20 10:53:47,815 - INFO - __main__ - Using LLM: llama3.2:3b via rag_agent_nodes.llm
2025-05-20 10:53:47,816 - INFO - __main__ - --- New Moodboard Generation Run ---
2025-05-20 10:53:47,816 - INFO - __main__ - Execution Mode: SEQUENTIAL
2025-05-20 10:53:47,816 - INFO - __main__ - Building graph: Adding nodes...
2025-05-20 10:53:47,816 - INFO - __main__ - Building graph: Entry point set to 'initial_processor'.
2025-05-20 10:53:47,817 - INFO - __main__ - Building graph: Using SEQUENTIAL agent execution flow.
2025-05-20 10:53:47,817 - INFO - __main__ - Building graph: Final edge to END set from 'advice_combiner'.
2025-05-20 10:53:47,821 - INFO - __main__ - LangGraph RAG Moodboard Generator Compiled.
2025-05-20 10:54:09,707 - INFO - __main__ - User Text Query: retro funky pop song
2025-05-20 10:54:10,367 - INFO - __main__ - No audio file provided by user.
2025-05-20 10:54:10,367 - INFO - __main__ - Similarity Summary (Placeholder):
Audio provided; similarity analysis resulted in this list of similar tracks based on audio extracted features. Here is the list:

| #  | Title                | Artist                          | Key       | BPM | Genres                      | Other tags                          |
| -- | -------------------- | ------------------------------- | --------- | --- | --------------------------- | ----------------------------------- |
| 1  | Serge’s Kiss         | Daybehavior                     | C minor   | 109 | alternative rock, dream pop | re-recording, pop, alternative rock |
| 2  | Imagine              | John Lennon                     | C major   | 75  | rock, pop                   | piano, classic, 1971                |
| 3  | Billie Jean          | Michael Jackson                 | F ♯ minor | 117 | pop, R&B                    | dance, 1980s, synth                 |
| 4  | Smells Like Teen…    | Nirvana                         | F minor   | 117 | grunge, alternative rock    | 1990s, guitar riff, breakthrough    |
| 5  | Rolling in the Deep  | Adele                           | C minor   | 105 | pop, soul                   | powerful vocals, 2010s              |
| 6  | Take Five            | The Dave Brubeck Quartet        | E ♭ minor | 174 | jazz, cool jazz             | saxophone, classic, instrumental    |
| 7  | Get Lucky            | Daft Punk ft. Pharrell Williams | F minor   | 116 | disco, electronic, funk     | dancefloor, 2010s                   |
| 8  | Nothing Else Matters | Metallica                       | E minor   | 142 | heavy metal, rock           | ballad, acoustic intro              |
| 9  | Bad Guy              | Billie Eilish                   | G minor   | 135 | pop, electro-pop            | whisper vocals, modern sound        |
| 10 | Clocks               | Coldplay                        | E ♭ major | 131 | alternative rock, pop rock  | piano riff, 2000s                   |

2025-05-20 10:54:10,367 - INFO - __main__ - Initial graph state prepared: {'user_text_query': 'retro funky pop song', 'user_audio_path': None, 'similar_tracks_summary': 'Audio provided; similarity analysis resulted in this list of similar tracks based on audio extracted features. Here is the list:\n\n| #  | Title                | Artist                          | Key       | BPM | Genres                      | Other tags                          |\n| -- | -------------------- | ------------------------------- | --------- | --- | --------------------------- | ----------------------------------- |\n| 1  | Serge’s Kiss         | Daybehavior                     | C minor   | 109 | alternative rock, dream pop | re-recording, pop, alternative rock |\n| 2  | Imagine              | John Lennon                     | C major   | 75  | rock, pop                   | piano, classic, 1971                |\n| 3  | Billie Jean          | Michael Jackson                 | F ♯ minor | 117 | pop, R&B                    | dance, 1980s, synth                 |\n| 4  | Smells Like Teen…    | Nirvana                         | F minor   | 117 | grunge, alternative rock    | 1990s, guitar riff, breakthrough    |\n| 5  | Rolling in the Deep  | Adele                           | C minor   | 105 | pop, soul                   | powerful vocals, 2010s              |\n| 6  | Take Five            | The Dave Brubeck Quartet        | E ♭ minor | 174 | jazz, cool jazz             | saxophone, classic, instrumental    |\n| 7  | Get Lucky            | Daft Punk ft. Pharrell Williams | F minor   | 116 | disco, electronic, funk     | dancefloor, 2010s                   |\n| 8  | Nothing Else Matters | Metallica                       | E minor   | 142 | heavy metal, rock           | ballad, acoustic intro              |\n| 9  | Bad Guy              | Billie Eilish                   | G minor   | 135 | pop, electro-pop            | whisper vocals, modern sound        |\n| 10 | Clocks               | Coldplay                        | E ♭ major | 131 | alternative rock, pop rock  | piano riff, 2000s                   |\n', 'project_goal_summary': '', 'rhythm_advice': None, 'music_theory_advice': None, 'instruments_advice': None, 'lyrics_advice': None, 'production_advice': None, 'final_moodboard': None, 'error_message': None, 'should_run_lyrics_agent': False}
2025-05-20 10:54:10,367 - INFO - __main__ - Invoking LangGraph workflow...
2025-05-20 10:54:10,372 - INFO - rag_agent_nodes - --- Starting NODE: Processing Initial Input & Synthesizing Goal ---
2025-05-20 10:54:10,373 - INFO - rag_agent_nodes - User Text Query: 'retro funky pop song'
2025-05-20 10:54:10,373 - INFO - rag_agent_nodes - Similar Tracks Summary Input:
Audio provided; similarity analysis resulted in this list of similar tracks based on audio extracted features. Here is the list:

| #  | Title                | Artist                          | Key       | BPM | Genres                      | Other tags                          |
| -- | -------------------- | ------------------------------- | --------- | --- | --------------------------- | ----------------------------------- |
| 1  | Serge’s Kiss         | Daybehavior                     | C minor   | 109 | alternative rock, dream pop | re-recording, pop, alternative rock |
| 2  | Imagine              | John Lennon                     | C major   | 75  | rock, pop                   | piano, classic, 1971                |
| 3  | Billie Jean          | Michael Jackson                 | F ♯ minor | 117 | pop, R&B                    | dance, 1980s, synth                 |
| 4  | Smells Like Teen…    | Nirvana                         | F minor   | 117 | grunge, alternative rock    | 1990s, guitar riff, breakthrough    |
| 5  | Rolling in the Deep  | Adele                           | C minor   | 105 | pop, soul                   | powerful vocals, 2010s              |
| 6  | Take Five            | The Dave Brubeck Quartet        | E ♭ minor | 174 | jazz, cool jazz             | saxophone, classic, instrumental    |
| 7  | Get Lucky            | Daft Punk ft. Pharrell Williams | F minor   | 116 | disco, electronic, funk     | dancefloor, 2010s                   |
| 8  | Nothing Else Matters | Metallica                       | E minor   | 142 | heavy metal, rock           | ballad, acoustic intro              |
| 9  | Bad Guy              | Billie Eilish                   | G minor   | 135 | pop, electro-pop            | whisper vocals, modern sound        |
| 10 | Clocks               | Coldplay                        | E ♭ major | 131 | alternative rock, pop rock  | piano riff, 2000s                   |

2025-05-20 10:54:10,373 - INFO - rag_agent_nodes - Attempting to generate project goal summary. Full Prompt:

You are a helpful assistant that synthesizes information for a music creation project.
Based on the user's request and an analysis of similar music (if provided), create a concise project goal summary.
This summary will guide other specialized AI agents in providing creative advice.
Focus on extracting key musical elements: genre, target artists/style, mood, instrumentation, tempo, and key signatures mentioned or implied.
Keep the summary to 1-2 concise paragraphs.

User Request:
---
retro funky pop song
---

Provided Similarity Analysis (characteristics of the user's audio or comparable tracks):
---
Audio provided; similarity analysis resulted in this list of similar tracks based on audio extracted features. Here is the list:

| #  | Title                | Artist                          | Key       | BPM | Genres                      | Other tags                          |
| -- | -------------------- | ------------------------------- | --------- | --- | --------------------------- | ----------------------------------- |
| 1  | Serge’s Kiss         | Daybehavior                     | C minor   | 109 | alternative rock, dream pop | re-recording, pop, alternative rock |
| 2  | Imagine              | John Lennon                     | C major   | 75  | rock, pop                   | piano, classic, 1971                |
| 3  | Billie Jean          | Michael Jackson                 | F ♯ minor | 117 | pop, R&B                    | dance, 1980s, synth                 |
| 4  | Smells Like Teen…    | Nirvana                         | F minor   | 117 | grunge, alternative rock    | 1990s, guitar riff, breakthrough    |
| 5  | Rolling in the Deep  | Adele                           | C minor   | 105 | pop, soul                   | powerful vocals, 2010s              |
| 6  | Take Five            | The Dave Brubeck Quartet        | E ♭ minor | 174 | jazz, cool jazz             | saxophone, classic, instrumental    |
| 7  | Get Lucky            | Daft Punk ft. Pharrell Williams | F minor   | 116 | disco, electronic, funk     | dancefloor, 2010s                   |
| 8  | Nothing Else Matters | Metallica                       | E minor   | 142 | heavy metal, rock           | ballad, acoustic intro              |
| 9  | Bad Guy              | Billie Eilish                   | G minor   | 135 | pop, electro-pop            | whisper vocals, modern sound        |
| 10 | Clocks               | Coldplay                        | E ♭ major | 131 | alternative rock, pop rock  | piano riff, 2000s                   |

---

Concise Project Goal Summary:

2025-05-20 10:54:10,383 - INFO - openai._base_client - Retrying request to /chat/completions in 0.405954 seconds
2025-05-20 10:54:10,792 - INFO - openai._base_client - Retrying request to /chat/completions in 0.826511 seconds
2025-05-20 10:54:11,621 - ERROR - rag_agent_nodes - CRITICAL ERROR during project goal synthesis LLM call: Connection error.
Traceback (most recent call last):
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/site-packages/httpx/_transports/default.py", line 101, in map_httpcore_exceptions
    yield
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/site-packages/httpx/_transports/default.py", line 250, in handle_request
    resp = self._pool.handle_request(req)
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 111] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/site-packages/openai/_base_client.py", line 969, in request
    response = self._client.send(
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/site-packages/httpx/_client.py", line 1014, in _send_single_request
    response = transport.handle_request(request)
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/site-packages/httpx/_transports/default.py", line 249, in handle_request
    with map_httpcore_exceptions():
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/site-packages/httpx/_transports/default.py", line 118, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 111] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/raduc/Documents/Code/Licentzio/MusicBlock/RAG/rag_agent_nodes.py", line 103, in process_initial_input_node
    response = llm.invoke(prompt)
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/site-packages/langchain_core/language_models/chat_models.py", line 370, in invoke
    self.generate_prompt(
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/site-packages/langchain_core/language_models/chat_models.py", line 947, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/site-packages/langchain_core/language_models/chat_models.py", line 766, in generate
    self._generate_with_cache(
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/site-packages/langchain_core/language_models/chat_models.py", line 1012, in _generate_with_cache
    result = self._generate(
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/site-packages/langchain_openai/chat_models/base.py", line 959, in _generate
    response = self.client.create(**payload)
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/site-packages/openai/_utils/_utils.py", line 287, in wrapper
    return func(*args, **kwargs)
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/site-packages/openai/resources/chat/completions/completions.py", line 925, in create
    return self._post(
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/site-packages/openai/_base_client.py", line 1239, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/site-packages/openai/_base_client.py", line 1001, in request
    raise APIConnectionError(request=request) from err
openai.APIConnectionError: Connection error.
2025-05-20 10:54:11,632 - INFO - rag_agent_nodes - Should run lyrics agent: False
2025-05-20 10:54:11,632 - INFO - rag_agent_nodes - --- Finished NODE: Processing Initial Input. Output: {'project_goal_summary': 'Error: Could not synthesize project goal. Details: Connection error.', 'should_run_lyrics_agent': False, 'error_message': 'Failed to synthesize project goal: Connection error.'} ---
2025-05-20 10:54:11,634 - INFO - __main__ - Output from node 'initial_processor': {'project_goal_summary': 'Error: Could not synthesize project goal. Details: Connection error.', 'should_run_lyrics_agent': False, 'error_message': 'Failed to synthesize project goal: Connection error.'}
2025-05-20 10:54:11,634 - INFO - rag_agent_nodes - --- Starting NODE: Rhythm Agent ---
2025-05-20 10:54:11,634 - WARNING - rag_agent_nodes - NODE (Rhythm_agent): Skipping Rhythm advice due to earlier critical error: Failed to synthesize project goal: Connection error.
2025-05-20 10:54:11,635 - INFO - __main__ - Output from node 'rhythm_agent': {'rhythm_advice': 'Skipping Rhythm advice due to earlier critical error: Failed to synthesize project goal: Connection error.'}
2025-05-20 10:54:11,635 - INFO - rag_agent_nodes - --- Starting NODE: Music Theory Agent ---
2025-05-20 10:54:11,635 - WARNING - rag_agent_nodes - NODE (Music Theory_agent): Skipping Music Theory advice due to earlier critical error: Failed to synthesize project goal: Connection error.
2025-05-20 10:54:11,636 - INFO - __main__ - Output from node 'music_theory_agent': {'music_theory_advice': 'Skipping Music Theory advice due to earlier critical error: Failed to synthesize project goal: Connection error.'}
2025-05-20 10:54:11,636 - INFO - rag_agent_nodes - --- Starting NODE: Instruments Agent ---
2025-05-20 10:54:11,636 - WARNING - rag_agent_nodes - NODE (Instruments_agent): Skipping Instruments advice due to earlier critical error: Failed to synthesize project goal: Connection error.
2025-05-20 10:54:11,636 - INFO - __main__ - Output from node 'instruments_agent': {'instruments_advice': 'Skipping Instruments advice due to earlier critical error: Failed to synthesize project goal: Connection error.'}
2025-05-20 10:54:11,636 - INFO - rag_agent_nodes - --- Evaluating NODE: Lyrics Agent ---
2025-05-20 10:54:11,636 - INFO - rag_agent_nodes - NODE (Lyrics_agent): Skipping as should_run_lyrics_agent flag is False.
2025-05-20 10:54:11,637 - INFO - __main__ - Output from node 'lyrics_agent': {'lyrics_advice': ''}
2025-05-20 10:54:11,637 - INFO - rag_agent_nodes - --- Starting NODE: Production Agent ---
2025-05-20 10:54:11,637 - WARNING - rag_agent_nodes - NODE (Production_agent): Skipping Production advice due to earlier critical error: Failed to synthesize project goal: Connection error.
2025-05-20 10:54:11,637 - INFO - __main__ - Output from node 'production_agent': {'production_advice': 'Skipping Production advice due to earlier critical error: Failed to synthesize project goal: Connection error.'}
2025-05-20 10:54:11,638 - INFO - rag_agent_nodes - --- Starting NODE: Combining Advice ---
2025-05-20 10:54:11,638 - ERROR - rag_agent_nodes - Moodboard combination reflects critical setup error: Failed to synthesize project goal: Connection error.
2025-05-20 10:54:11,638 - INFO - rag_agent_nodes - Advice for 'Rhythm & Groove':
Skipping Rhythm advice due to earlier critical error: Failed to synthesize project goal: Connection error.
2025-05-20 10:54:11,638 - INFO - rag_agent_nodes - Advice for 'Music Theory & Harmony':
Skipping Music Theory advice due to earlier critical error: Failed to synthesize project goal: Connection error.
2025-05-20 10:54:11,638 - INFO - rag_agent_nodes - Advice for 'Timbre & Instrumentation':
Skipping Instruments advice due to earlier critical error: Failed to synthesize project goal: Connection error.
2025-05-20 10:54:11,638 - INFO - rag_agent_nodes - 'Lyrics & Vocals' was intentionally skipped.
2025-05-20 10:54:11,638 - INFO - rag_agent_nodes - Advice for 'Production & Mix':
Skipping Production advice due to earlier critical error: Failed to synthesize project goal: Connection error.
2025-05-20 10:54:11,638 - INFO - rag_agent_nodes - Final moodboard assembled. Length: 830 chars.
2025-05-20 10:54:11,638 - INFO - rag_agent_nodes - --- Finished NODE: Combining Advice ---
2025-05-20 10:54:11,638 - INFO - __main__ - Output from node 'advice_combiner': {'final_moodboard': '# Music Inspiration Moodboard - Generation Failed\n\n## Critical Error During Setup\nFailed to synthesize project goal: Connection error.\n\nAttempted Project Goal:\nError: Could not synthesize project goal. Details: Connection error.\n\n\n## Rhythm & Groove\nSkipping Rhythm advice due to earlier critical error: Failed to synthesize project goal: Connection error.\n\n## Music Theory & Harmony\nSkipping Music Theory advice due to earlier critical error: Failed to synthesize project goal: Connection error.\n\n## Timbre & Instrumentation\nSkipping Instruments advice due to earlier critical error: Failed to synthesize project goal: Connection error.\n\n## Lyrics & Vocals\n(This section was intentionally skipped)\n\n## Production & Mix\nSkipping Production advice due to earlier critical error: Failed to synthesize project goal: Connection error.', 'error_message': 'Failed to synthesize project goal: Connection error.'}
2025-05-20 10:54:11,639 - INFO - rag_agent_nodes - --- Starting NODE: Processing Initial Input & Synthesizing Goal ---
2025-05-20 10:54:11,640 - INFO - rag_agent_nodes - User Text Query: 'retro funky pop song'
2025-05-20 10:54:11,640 - INFO - rag_agent_nodes - Similar Tracks Summary Input:
Audio provided; similarity analysis resulted in this list of similar tracks based on audio extracted features. Here is the list:

| #  | Title                | Artist                          | Key       | BPM | Genres                      | Other tags                          |
| -- | -------------------- | ------------------------------- | --------- | --- | --------------------------- | ----------------------------------- |
| 1  | Serge’s Kiss         | Daybehavior                     | C minor   | 109 | alternative rock, dream pop | re-recording, pop, alternative rock |
| 2  | Imagine              | John Lennon                     | C major   | 75  | rock, pop                   | piano, classic, 1971                |
| 3  | Billie Jean          | Michael Jackson                 | F ♯ minor | 117 | pop, R&B                    | dance, 1980s, synth                 |
| 4  | Smells Like Teen…    | Nirvana                         | F minor   | 117 | grunge, alternative rock    | 1990s, guitar riff, breakthrough    |
| 5  | Rolling in the Deep  | Adele                           | C minor   | 105 | pop, soul                   | powerful vocals, 2010s              |
| 6  | Take Five            | The Dave Brubeck Quartet        | E ♭ minor | 174 | jazz, cool jazz             | saxophone, classic, instrumental    |
| 7  | Get Lucky            | Daft Punk ft. Pharrell Williams | F minor   | 116 | disco, electronic, funk     | dancefloor, 2010s                   |
| 8  | Nothing Else Matters | Metallica                       | E minor   | 142 | heavy metal, rock           | ballad, acoustic intro              |
| 9  | Bad Guy              | Billie Eilish                   | G minor   | 135 | pop, electro-pop            | whisper vocals, modern sound        |
| 10 | Clocks               | Coldplay                        | E ♭ major | 131 | alternative rock, pop rock  | piano riff, 2000s                   |

2025-05-20 10:54:11,640 - INFO - rag_agent_nodes - Attempting to generate project goal summary. Full Prompt:

You are a helpful assistant that synthesizes information for a music creation project.
Based on the user's request and an analysis of similar music (if provided), create a concise project goal summary.
This summary will guide other specialized AI agents in providing creative advice.
Focus on extracting key musical elements: genre, target artists/style, mood, instrumentation, tempo, and key signatures mentioned or implied.
Keep the summary to 1-2 concise paragraphs.

User Request:
---
retro funky pop song
---

Provided Similarity Analysis (characteristics of the user's audio or comparable tracks):
---
Audio provided; similarity analysis resulted in this list of similar tracks based on audio extracted features. Here is the list:

| #  | Title                | Artist                          | Key       | BPM | Genres                      | Other tags                          |
| -- | -------------------- | ------------------------------- | --------- | --- | --------------------------- | ----------------------------------- |
| 1  | Serge’s Kiss         | Daybehavior                     | C minor   | 109 | alternative rock, dream pop | re-recording, pop, alternative rock |
| 2  | Imagine              | John Lennon                     | C major   | 75  | rock, pop                   | piano, classic, 1971                |
| 3  | Billie Jean          | Michael Jackson                 | F ♯ minor | 117 | pop, R&B                    | dance, 1980s, synth                 |
| 4  | Smells Like Teen…    | Nirvana                         | F minor   | 117 | grunge, alternative rock    | 1990s, guitar riff, breakthrough    |
| 5  | Rolling in the Deep  | Adele                           | C minor   | 105 | pop, soul                   | powerful vocals, 2010s              |
| 6  | Take Five            | The Dave Brubeck Quartet        | E ♭ minor | 174 | jazz, cool jazz             | saxophone, classic, instrumental    |
| 7  | Get Lucky            | Daft Punk ft. Pharrell Williams | F minor   | 116 | disco, electronic, funk     | dancefloor, 2010s                   |
| 8  | Nothing Else Matters | Metallica                       | E minor   | 142 | heavy metal, rock           | ballad, acoustic intro              |
| 9  | Bad Guy              | Billie Eilish                   | G minor   | 135 | pop, electro-pop            | whisper vocals, modern sound        |
| 10 | Clocks               | Coldplay                        | E ♭ major | 131 | alternative rock, pop rock  | piano riff, 2000s                   |

---

Concise Project Goal Summary:

2025-05-20 10:54:11,642 - INFO - openai._base_client - Retrying request to /chat/completions in 0.419024 seconds
2025-05-20 10:54:12,064 - INFO - openai._base_client - Retrying request to /chat/completions in 0.884920 seconds
2025-05-20 10:54:12,954 - ERROR - rag_agent_nodes - CRITICAL ERROR during project goal synthesis LLM call: Connection error.
Traceback (most recent call last):
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/site-packages/httpx/_transports/default.py", line 101, in map_httpcore_exceptions
    yield
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/site-packages/httpx/_transports/default.py", line 250, in handle_request
    resp = self._pool.handle_request(req)
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 111] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/site-packages/openai/_base_client.py", line 969, in request
    response = self._client.send(
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/site-packages/httpx/_client.py", line 1014, in _send_single_request
    response = transport.handle_request(request)
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/site-packages/httpx/_transports/default.py", line 249, in handle_request
    with map_httpcore_exceptions():
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/site-packages/httpx/_transports/default.py", line 118, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 111] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/raduc/Documents/Code/Licentzio/MusicBlock/RAG/rag_agent_nodes.py", line 103, in process_initial_input_node
    response = llm.invoke(prompt)
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/site-packages/langchain_core/language_models/chat_models.py", line 370, in invoke
    self.generate_prompt(
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/site-packages/langchain_core/language_models/chat_models.py", line 947, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/site-packages/langchain_core/language_models/chat_models.py", line 766, in generate
    self._generate_with_cache(
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/site-packages/langchain_core/language_models/chat_models.py", line 1012, in _generate_with_cache
    result = self._generate(
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/site-packages/langchain_openai/chat_models/base.py", line 959, in _generate
    response = self.client.create(**payload)
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/site-packages/openai/_utils/_utils.py", line 287, in wrapper
    return func(*args, **kwargs)
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/site-packages/openai/resources/chat/completions/completions.py", line 925, in create
    return self._post(
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/site-packages/openai/_base_client.py", line 1239, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "/home/raduc/miniconda3/envs/ess/lib/python3.10/site-packages/openai/_base_client.py", line 1001, in request
    raise APIConnectionError(request=request) from err
openai.APIConnectionError: Connection error.
2025-05-20 10:54:12,955 - INFO - rag_agent_nodes - Should run lyrics agent: False
2025-05-20 10:54:12,955 - INFO - rag_agent_nodes - --- Finished NODE: Processing Initial Input. Output: {'project_goal_summary': 'Error: Could not synthesize project goal. Details: Connection error.', 'should_run_lyrics_agent': False, 'error_message': 'Failed to synthesize project goal: Connection error.'} ---
2025-05-20 10:54:12,956 - INFO - rag_agent_nodes - --- Starting NODE: Rhythm Agent ---
2025-05-20 10:54:12,956 - WARNING - rag_agent_nodes - NODE (Rhythm_agent): Skipping Rhythm advice due to earlier critical error: Failed to synthesize project goal: Connection error.
2025-05-20 10:54:12,957 - INFO - rag_agent_nodes - --- Starting NODE: Music Theory Agent ---
2025-05-20 10:54:12,957 - WARNING - rag_agent_nodes - NODE (Music Theory_agent): Skipping Music Theory advice due to earlier critical error: Failed to synthesize project goal: Connection error.
2025-05-20 10:54:12,958 - INFO - rag_agent_nodes - --- Starting NODE: Instruments Agent ---
2025-05-20 10:54:12,958 - WARNING - rag_agent_nodes - NODE (Instruments_agent): Skipping Instruments advice due to earlier critical error: Failed to synthesize project goal: Connection error.
2025-05-20 10:54:12,958 - INFO - rag_agent_nodes - --- Evaluating NODE: Lyrics Agent ---
2025-05-20 10:54:12,958 - INFO - rag_agent_nodes - NODE (Lyrics_agent): Skipping as should_run_lyrics_agent flag is False.
2025-05-20 10:54:12,959 - INFO - rag_agent_nodes - --- Starting NODE: Production Agent ---
2025-05-20 10:54:12,959 - WARNING - rag_agent_nodes - NODE (Production_agent): Skipping Production advice due to earlier critical error: Failed to synthesize project goal: Connection error.
2025-05-20 10:54:12,959 - INFO - rag_agent_nodes - --- Starting NODE: Combining Advice ---
2025-05-20 10:54:12,959 - ERROR - rag_agent_nodes - Moodboard combination reflects critical setup error: Failed to synthesize project goal: Connection error.
2025-05-20 10:54:12,960 - INFO - rag_agent_nodes - Advice for 'Rhythm & Groove':
Skipping Rhythm advice due to earlier critical error: Failed to synthesize project goal: Connection error.
2025-05-20 10:54:12,960 - INFO - rag_agent_nodes - Advice for 'Music Theory & Harmony':
Skipping Music Theory advice due to earlier critical error: Failed to synthesize project goal: Connection error.
2025-05-20 10:54:12,960 - INFO - rag_agent_nodes - Advice for 'Timbre & Instrumentation':
Skipping Instruments advice due to earlier critical error: Failed to synthesize project goal: Connection error.
2025-05-20 10:54:12,960 - INFO - rag_agent_nodes - 'Lyrics & Vocals' was intentionally skipped.
2025-05-20 10:54:12,960 - INFO - rag_agent_nodes - Advice for 'Production & Mix':
Skipping Production advice due to earlier critical error: Failed to synthesize project goal: Connection error.
2025-05-20 10:54:12,960 - INFO - rag_agent_nodes - Final moodboard assembled. Length: 830 chars.
2025-05-20 10:54:12,960 - INFO - rag_agent_nodes - --- Finished NODE: Combining Advice ---
2025-05-20 10:54:12,960 - INFO - __main__ - Graph invocation complete. Final State: {'user_text_query': 'retro funky pop song', 'similar_tracks_summary': 'Audio provided; similarity analysis resulted in this list of similar tracks based on audio extracted features. Here is the list:\n\n| #  | Title                | Artist                          | Key       | BPM | Genres                      | Other tags                          |\n| -- | -------------------- | ------------------------------- | --------- | --- | --------------------------- | ----------------------------------- |\n| 1  | Serge’s Kiss         | Daybehavior                     | C minor   | 109 | alternative rock, dream pop | re-recording, pop, alternative rock |\n| 2  | Imagine              | John Lennon                     | C major   | 75  | rock, pop                   | piano, classic, 1971                |\n| 3  | Billie Jean          | Michael Jackson                 | F ♯ minor | 117 | pop, R&B                    | dance, 1980s, synth                 |\n| 4  | Smells Like Teen…    | Nirvana                         | F minor   | 117 | grunge, alternative rock    | 1990s, guitar riff, breakthrough    |\n| 5  | Rolling in the Deep  | Adele                           | C minor   | 105 | pop, soul                   | powerful vocals, 2010s              |\n| 6  | Take Five            | The Dave Brubeck Quartet        | E ♭ minor | 174 | jazz, cool jazz             | saxophone, classic, instrumental    |\n| 7  | Get Lucky            | Daft Punk ft. Pharrell Williams | F minor   | 116 | disco, electronic, funk     | dancefloor, 2010s                   |\n| 8  | Nothing Else Matters | Metallica                       | E minor   | 142 | heavy metal, rock           | ballad, acoustic intro              |\n| 9  | Bad Guy              | Billie Eilish                   | G minor   | 135 | pop, electro-pop            | whisper vocals, modern sound        |\n| 10 | Clocks               | Coldplay                        | E ♭ major | 131 | alternative rock, pop rock  | piano riff, 2000s                   |\n', 'project_goal_summary': 'Error: Could not synthesize project goal. Details: Connection error.', 'rhythm_advice': 'Skipping Rhythm advice due to earlier critical error: Failed to synthesize project goal: Connection error.', 'music_theory_advice': 'Skipping Music Theory advice due to earlier critical error: Failed to synthesize project goal: Connection error.', 'instruments_advice': 'Skipping Instruments advice due to earlier critical error: Failed to synthesize project goal: Connection error.', 'lyrics_advice': '', 'production_advice': 'Skipping Production advice due to earlier critical error: Failed to synthesize project goal: Connection error.', 'final_moodboard': '# Music Inspiration Moodboard - Generation Failed\n\n## Critical Error During Setup\nFailed to synthesize project goal: Connection error.\n\nAttempted Project Goal:\nError: Could not synthesize project goal. Details: Connection error.\n\n\n## Rhythm & Groove\nSkipping Rhythm advice due to earlier critical error: Failed to synthesize project goal: Connection error.\n\n## Music Theory & Harmony\nSkipping Music Theory advice due to earlier critical error: Failed to synthesize project goal: Connection error.\n\n## Timbre & Instrumentation\nSkipping Instruments advice due to earlier critical error: Failed to synthesize project goal: Connection error.\n\n## Lyrics & Vocals\n(This section was intentionally skipped)\n\n## Production & Mix\nSkipping Production advice due to earlier critical error: Failed to synthesize project goal: Connection error.', 'should_run_lyrics_agent': False, 'error_message': 'Failed to synthesize project goal: Connection error.'}
2025-05-20 10:54:12,960 - INFO - __main__ - --- Moodboard Generation Attempt Finished ---
2025-05-20 10:54:12,960 - INFO - __main__ - Successfully generated final moodboard.
2025-05-20 10:54:12,960 - INFO - __main__ - Final Moodboard Content:
# Music Inspiration Moodboard - Generation Failed

## Critical Error During Setup
Failed to synthesize project goal: Connection error.

Attempted Project Goal:
Error: Could not synthesize project goal. Details: Connection error.


## Rhythm & Groove
Skipping Rhythm advice due to earlier critical error: Failed to synthesize project goal: Connection error.

## Music Theory & Harmony
Skipping Music Theory advice due to earlier critical error: Failed to synthesize project goal: Connection error.

## Timbre & Instrumentation
Skipping Instruments advice due to earlier critical error: Failed to synthesize project goal: Connection error.

## Lyrics & Vocals
(This section was intentionally skipped)

## Production & Mix
Skipping Production advice due to earlier critical error: Failed to synthesize project goal: Connection error.
2025-05-20 10:54:12,961 - ERROR - __main__ - Moodboard generation failed with critical error: Failed to synthesize project goal: Connection error.
2025-05-20 10:54:12,961 - INFO - __main__ - Log file for this run: /home/raduc/Documents/Code/Licentzio/MusicBlock/rag_logs/moodboard_run_20250520_105347.log
